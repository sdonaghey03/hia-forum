{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js"],"names":["define","categorySelector","categoryList","init","postContainer","postData","listContainer","find","length","on","toggleDropDirection","socket","emit","err","categories","app","alertError","message","categoriesData","filter","category","link","categoryMap","forEach","children","cid","parent","disabledClass","push","rootCategories","Object","keys","key","sort","a","b","order","recursive","parseAndTranslate","pullRight","html","append","selectedCategory","hasOwnProperty","changeCategory","$","parseInt","this","attr","trigger","selectCategory","getSelectedCategory","translateText","name","addClass","text","removeClass","selectedCid","toggleClass","outerHeight","window","height","getSelectedCid","require","tags","onChangeCategory","level","bullet","value","appendTo","child"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js","sourcesContent":["\n'use strict';\n\n/*globals define, socket, app*/\n\ndefine('composer/categoryList', ['categorySelector'], function(categorySelector) {\n\tvar categoryList = {};\n\n\tcategoryList.init = function(postContainer, postData) {\n\t\tvar listContainer = postContainer.find('.category-list-container');\n\t\tif (!listContainer.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tpostContainer.on('action:composer.resize', function () {\n\t\t\ttoggleDropDirection(postContainer);\n\t\t});\n\n\t\tsocket.emit('categories.getCategoriesByPrivilege', 'topics:create', function(err, categories) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tvar categoriesData = [];\n\n\t\t\tcategories = categories.filter(function(category) {\n\t\t\t\treturn category && !category.link;\n\t\t\t});\n\n\t\t\tvar categoryMap = {};\n\t\t\tcategories.forEach(function(category) {\n\t\t\t\tcategory.children = [];\n\t\t\t\tcategoryMap[category.cid] = category;\n\t\t\t});\n\n\t\t\tcategories.forEach(function(category) {\n\t\t\t\tif (category.parent) {\n\t\t\t\t\tvar cid = category.parent.cid;\n\t\t\t\t\tif (!categoryMap[cid]) {\n\t\t\t\t\t\tcategoryMap[cid] = category.parent;\n\t\t\t\t\t\tcategoryMap[cid].disabledClass = true;\n\t\t\t\t\t}\n\t\t\t\t\tcategoryMap[cid].children = categoryMap[cid].children || [];\n\t\t\t\t\tcategoryMap[cid].children.push(category);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar rootCategories = [];\n\t\t\tObject.keys(categoryMap).forEach(function(key) {\n\t\t\t\tif (!categoryMap[key].parent) {\n\t\t\t\t\trootCategories.push(categoryMap[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t\trootCategories = rootCategories.sort(function(a, b) {\n\t\t\t\treturn a.order - b.order;\n\t\t\t});\n\n\t\t\trootCategories.forEach(function (category) {\n\t\t\t\trecursive(category, categoriesData, '');\n\t\t\t});\n\n\t\t\tapp.parseAndTranslate('partials/category-selector', {\n\t\t\t\tcategories: categoriesData,\n\t\t\t\tpullRight: true\n\t\t\t}, function (html) {\n\t\t\t\tlistContainer.append(html);\n\t\t\t\tcategorySelector.init(listContainer.find('[component=\"category-selector\"]'), function (selectedCategory) {\n\t\t\t\t\tif (postData.hasOwnProperty('cid')) {\n\t\t\t\t\t\tchangeCategory(postContainer, postData, selectedCategory.cid);\n\t\t\t\t\t}\n\n\t\t\t\t\t$('[tabindex=' + (parseInt($(this).attr('tabindex'), 10) + 1) + ']').trigger('focus');\n\t\t\t\t});\n\n\t\t\t\tif (postData.cid) {\n\t\t\t\t\tcategorySelector.selectCategory(postData.cid);\n\t\t\t\t}\n\n\t\t\t\tvar selectedCategory = categorySelector.getSelectedCategory();\n\n\t\t\t\t$('.category-name').translateText(selectedCategory ? selectedCategory.name : '[[modules:composer.select_category]]');\n\t\t\t\t$('.category-selector').find('li[data-cid=\"' + postData.cid + '\"]').addClass('active');\n\n\t\t\t\ttoggleDropDirection(postContainer);\n\t\t\t});\n\t\t});\n\n\n\t\t$('.category-selector').on('click', 'li', function() {\n\t\t\t$('.category-name').text($(this).text());\n\t\t\t$('.category-selector').removeClass('open');\n\t\t\t$('.category-selector li').removeClass('active');\n\t\t\t$(this).addClass('active');\n\t\t\tvar selectedCid = $(this).attr('data-cid');\n\t\t\tcategorySelector.selectCategory(selectedCid);\n\t\t\tif (postData.hasOwnProperty('cid')) {\n\t\t\t\tchangeCategory(postContainer, postData, selectedCid);\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction toggleDropDirection(postContainer) {\n\t\tpostContainer.find('.category-list-container [component=\"category-selector\"]').toggleClass('dropup', postContainer.outerHeight() < $(window).height() / 2);\n\t}\n\n\tcategoryList.getSelectedCid = function () {\n\t\tvar selectedCategory = categorySelector.getSelectedCategory();\n\t\treturn selectedCategory ? selectedCategory.cid : 0;\n\t};\n\n\tfunction changeCategory(postContainer, postData, cid) {\n\t\tpostData.cid = cid;\n\t\trequire(['composer/tags'], function (tags) {\n\t\t\ttags.onChangeCategory(postContainer, postData, cid);\n\t\t});\n\t}\n\n\tfunction recursive(category, categoriesData, level) {\n\t\tif (category.link) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar bullet = level ? '&bull; ' : '';\n\t\tcategory.value = category.cid;\n\t\tcategory.level = level;\n\t\tcategory.text = level + bullet + category.name;\n\t\tcategoriesData.push(category);\n\t\t$('<li data-cid=\"' + category.cid + '\">' + category.name + '</li>').appendTo($('.category-selector'));\n\t\tcategory.children.forEach(function (child) {\n\t\t\trecursive(child, categoriesData, '&nbsp;&nbsp;&nbsp;&nbsp;' + level);\n\t\t});\n\t}\n\n\treturn categoryList;\n});\n"]}