{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","navigator","index","count","navigatorUpdateTimeoutId","scrollActive","init","selector","toTop","toBottom","callback","calculateIndex","$","window","off","delayedUpdate","on","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","setCount","update","pathname","location","replace","config","relative_path","parts","split","value","updateTextAndProgressBar","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","undefined","threshold","els","length","first","attr","scrollTop","windowHeight","height","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","distanceToMiddle","Math","abs","offset","top","atTop","nearBottom","last","data","template","topic","anchorEl","get","anchorRect","getBoundingClientRect","translateHtml","fraction","width","animate","scrollToIndex","scrollBottom","scrollToPost","highlight","duration","console","log","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","usePagination","scrollMethod","topicPostSort","postcount","categoryTopicSort","topic_count","page","max","ceil","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","viewportHeight","navbarHeight","done","animateScroll","scrollToRect","highlightPost","addClass","removeClass"],"mappings":"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","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\n\ndefine('navigator', ['forum/pagination', 'components'], function (pagination, components) {\n\tvar navigator = {};\n\tvar index = 1;\n\tvar count = 0;\n\tvar navigatorUpdateTimeoutId;\n\n\tnavigator.scrollActive = false;\n\n\tnavigator.init = function (selector, count, toTop, toBottom, callback, calculateIndex) {\n\t\tindex = 1;\n\t\tnavigator.selector = selector;\n\t\tnavigator.callback = callback;\n\t\ttoTop = toTop || function () {};\n\t\ttoBottom = toBottom || function () {};\n\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\n\n\t\t$('.pagination-block .dropdown-menu').off('click').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\n\t\t$('.pagination-block').off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('.pagination-block input').focus();\n\t\t\t}, 100);\n\t\t});\n\n\t\t$('.pagination-block .pageup').off('click').on('click', navigator.scrollUp);\n\t\t$('.pagination-block .pagedown').off('click').on('click', navigator.scrollDown);\n\t\t$('.pagination-block .pagetop').off('click').on('click', toTop);\n\t\t$('.pagination-block .pagebottom').off('click').on('click', toBottom);\n\n\t\t$('.pagination-block input').on('keydown', function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tvar input = $(this);\n\t\t\t\tif (!utils.isNumber(input.val())) {\n\t\t\t\t\tinput.val('');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar index = parseInt(input.val(), 10);\n\t\t\t\tif (typeof calculateIndex === 'function') {\n\t\t\t\t\tindex = calculateIndex(index, count);\n\t\t\t\t}\n\n\t\t\t\tvar url = generateUrl(index);\n\t\t\t\tinput.val('');\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\tnavigator.setCount(count);\n\t\tnavigator.update(0);\n\t};\n\n\tfunction generateUrl(index) {\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\n\t\tvar parts = pathname.split('/');\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\n\t}\n\n\tnavigator.setCount = function (value) {\n\t\tcount = parseInt(value, 10);\n\t\tnavigator.updateTextAndProgressBar();\n\t};\n\n\tnavigator.show = function () {\n\t\ttoggle(true);\n\t};\n\n\tnavigator.disable = function () {\n\t\tcount = 0;\n\t\tindex = 1;\n\t\tnavigator.callback = null;\n\t\tnavigator.selector = null;\n\t\t$(window).off('scroll', navigator.delayedUpdate);\n\n\t\ttoggle(false);\n\t};\n\n\tfunction toggle(flag) {\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$('.pagination-block').toggleClass('ready', flag);\n\t}\n\n\tnavigator.delayedUpdate = function () {\n\t\tif (!navigatorUpdateTimeoutId) {\n\t\t\tnavigatorUpdateTimeoutId = setTimeout(function () {\n\t\t\t\tnavigator.update();\n\t\t\t\tnavigatorUpdateTimeoutId = undefined;\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tnavigator.update = function (threshold) {\n\t\t/*\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\n\t\t\ta spot where a user is expecting to begin reading.\n\t\t*/\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\n\n\t\tvar els = $(navigator.selector);\n\t\tif (els.length) {\n\t\t\tindex = parseInt(els.first().attr('data-index'), 10) + 1;\n\t\t}\n\n\t\tvar scrollTop = $(window).scrollTop();\n\t\tvar windowHeight = $(window).height();\n\t\tvar documentHeight = $(document).height();\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\n\t\tvar previousDistance = Number.MAX_VALUE;\n\t\tels.each(function () {\n\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - $(this).offset().top);\n\n\t\t\tif (distanceToMiddle > previousDistance) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (distanceToMiddle < previousDistance) {\n\t\t\t\tindex = parseInt($(this).attr('data-index'), 10) + 1;\n\t\t\t\tpreviousDistance = distanceToMiddle;\n\t\t\t}\n\t\t});\n\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\n\n\t\tif (atTop) {\n\t\t\tindex = 1;\n\t\t} else if (nearBottom) {\n\t\t\tindex = count;\n\t\t}\n\n\t\t// If a threshold is undefined, try to determine one based on new index\n\t\tif (threshold === undefined && ajaxify.data.template.topic === true) {\n\t\t\tif (atTop) {\n\t\t\t\tthreshold = 0;\n\t\t\t} else {\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\n\t\t\t\tif (anchorEl.length) {\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\n\t\t\t\t\tthreshold = anchorRect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (typeof navigator.callback === 'function') {\n\t\t\tnavigator.callback(index, count, threshold);\n\t\t}\n\n\t\tnavigator.updateTextAndProgressBar();\n\t\ttoggle(!!count);\n\t};\n\n\tnavigator.updateTextAndProgressBar = function () {\n\t\tif (!utils.isNumber(index)) {\n\t\t\treturn;\n\t\t}\n\t\tindex = index > count ? count : index;\n\n\t\t$('.pagination-block .pagination-text').translateHtml('[[global:pagination.out_of, ' + index + ', ' + count + ']]');\n\t\tvar fraction = $(window).scrollTop() / ($(document).height() - $(window).height());\n\t\t$('.pagination-block meter').val(fraction);\n\t\t$('.pagination-block .progress-bar').width((fraction * 100) + '%');\n\t};\n\n\tnavigator.scrollUp = function () {\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $(window).scrollTop() - $(window).height(),\n\t\t});\n\t};\n\n\tnavigator.scrollDown = function () {\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $(window).scrollTop() + $(window).height(),\n\t\t});\n\t};\n\n\tnavigator.scrollTop = function (index) {\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tajaxify.go(generateUrl());\n\t\t}\n\t};\n\n\tnavigator.scrollBottom = function (index) {\n\t\tif (parseInt(index, 10) < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t}\n\t};\n\n\tnavigator.scrollToPost = function (index, highlight, duration) {\n\t\tconsole.log('[navigator.scrollToPost] deprecated please use, navigator.scrollToIndex');\n\t\tnavigator.scrollToIndex(index, highlight, duration);\n\t};\n\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\n\t\tvar inTopic = !!components.get('topic').length;\n\t\tvar inCategory = !!components.get('category').length;\n\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\n\t\t\treturn;\n\t\t}\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\n\t\t// if in topic and item already on page\n\t\tif (inTopic && components.get('post/anchor', index).length) {\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\n\t\t}\n\n\t\t// if in category and item alreay on page\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\n\t\t}\n\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t\treturn;\n\t\t}\n\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\n\t\tif (inTopic) {\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\n\t\t\t\tindex = ajaxify.data.postcount - index;\n\t\t\t}\n\t\t} else if (inCategory) {\n\t\t\tif (config.categoryTopicSort === 'most_posts' || config.categoryTopicSort === 'oldest_to_newest') {\n\t\t\t\tindex = ajaxify.data.ajaxify.data.topic_count - index;\n\t\t\t}\n\t\t}\n\n\t\tvar page = Math.max(1, Math.ceil((index + 1) / config.postsPerPage));\n\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\tpagination.loadPage(page, function () {\n\t\t\t\tscrollMethod(index, highlight, duration);\n\t\t\t});\n\t\t} else {\n\t\t\tscrollMethod(index, highlight, duration);\n\t\t}\n\t};\n\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\n\t\tif (!scrollTo.length) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\treturn;\n\t\t}\n\t\tvar postHeight = scrollTo.height();\n\t\tvar viewportHeight = $(window).height();\n\t\tvar navbarHeight = components.get('navbar').height();\n\n\t\t// Temporarily disable navigator update on scroll\n\t\t$(window).off('scroll', navigator.update);\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\t\tvar done = false;\n\n\t\tfunction animateScroll() {\n\t\t\tvar scrollTop = 0;\n\t\t\tif (postHeight < viewportHeight) {\n\t\t\t\tscrollTop = (scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2));\n\t\t\t} else {\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight;\n\t\t\t}\n\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: scrollTop + 'px',\n\t\t\t}, duration, function () {\n\t\t\t\tif (done) {\n\t\t\t\t\t// Re-enable onScroll behaviour\n\t\t\t\t\t$(window).on('scroll', navigator.update);\n\t\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\n\t\t\t\t\tnavigator.update(scrollToRect.top);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdone = true;\n\n\t\t\t\tnavigator.scrollActive = false;\n\t\t\t\thighlightPost();\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\n\t\t\t});\n\t\t}\n\n\t\tfunction highlightPost() {\n\t\t\tif (highlight) {\n\t\t\t\tscrollTo.addClass('highlight');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tscrollTo.removeClass('highlight');\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\tanimateScroll();\n\t};\n\n\treturn navigator;\n});\n"]}