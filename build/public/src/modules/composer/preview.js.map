{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js"],"names":["define","preview","timeoutId","render","postContainer","callback","clearTimeout","textarea","find","setTimeout","socket","emit","val","err","$","addClass","html","window","trigger","matchScroll","length","diff","scrollHeight","height","scrollPercent","scrollTop","Math","max","handleToggler","hidePreview","togglePreview","localStorage","setItem","showPreview","removeItem","show","previewContainer","toggleClass","writeContainer","showBtn","focus","hideBtn","on","getItem"],"mappings":"AAAA,aAIAA,OAAO,mBAAoB,WAC1B,IAAIC,KAEJ,IAAIC,EAAY,EAEhBD,EAAQE,OAAS,SAASC,EAAeC,GACxCA,EAAWA,GAAY,aACvB,GAAIH,EAAW,CACdI,aAAaJ,GACbA,EAAY,EAEb,IAAIK,EAAWH,EAAcI,KAAK,YAElCN,EAAYO,WAAW,WACtBC,OAAOC,KAAK,iCAAkCJ,EAASK,MAAO,SAASC,EAAKZ,GAC3EC,EAAY,EACZ,GAAIW,EAAK,CACR,OAEDZ,EAAUa,EAAEb,GACZA,EAAQO,KAAK,4BAA4BO,SAAS,kBAClDX,EAAcI,KAAK,YAAYQ,KAAKf,GACpCa,EAAEG,QAAQC,QAAQ,2BAClBb,OAEC,MAGJJ,EAAQkB,YAAc,SAASf,GAC9B,IAAIG,EAAWH,EAAcI,KAAK,YAClC,IAAIP,EAAUG,EAAcI,KAAK,YAEjC,GAAID,EAASa,QAAUnB,EAAQmB,OAAQ,CACtC,IAAIC,EAAOd,EAAS,GAAGe,aAAef,EAASgB,SAE/C,GAAIF,IAAS,EAAG,CACf,OAGD,IAAIG,EAAgBjB,EAASkB,YAAcJ,EAE3CpB,EAAQwB,UAAUC,KAAKC,IAAI1B,EAAQ,GAAGqB,aAAerB,EAAQsB,SAAU,GAAKC,KAI9EvB,EAAQ2B,cAAgB,SAASxB,GAChC,SAASyB,IACRC,EAAc,OACdC,aAAaC,QAAQ,0BAA2B,MAGjD,SAASC,IACRH,EAAc,MACdC,aAAaG,WAAW,2BAGzB,SAASJ,EAAcK,GACtBC,EAAiBC,YAAY,QAASF,GACtCG,EAAeD,YAAY,aAAcF,GACzCI,EAAQF,YAAY,OAAQF,GAE5BrB,EAAE,UAAU0B,QACZvC,EAAQkB,YAAYf,GAGrB,IAAImC,EAAUnC,EAAcI,KAAK,oCAChCiC,EAAUrC,EAAcI,KAAK,sCAC7B4B,EAAmBtB,EAAE,sBACrBwB,EAAiBxB,EAAE,oBAEpB2B,EAAQC,GAAG,QAASb,GACpBU,EAAQG,GAAG,QAAST,GAEpB,GAAIF,aAAaY,QAAQ,2BAA4B,CACpDd,QACM,CACNI,MAIF,OAAOhC","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js","sourcesContent":["'use strict';\n\n/* globals define, socket*/\n\ndefine('composer/preview', function() {\n\tvar preview = {};\n\n\tvar timeoutId = 0;\n\n\tpreview.render = function(postContainer, callback) {\n\t\tcallback = callback || function() {};\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t\ttimeoutId = 0;\n\t\t}\n\t\tvar textarea = postContainer.find('textarea');\n\n\t\ttimeoutId = setTimeout(function() {\n\t\t\tsocket.emit('plugins.composer.renderPreview', textarea.val(), function(err, preview) {\n\t\t\t\ttimeoutId = 0;\n\t\t\t\tif (err) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpreview = $(preview);\n\t\t\t\tpreview.find('img:not(.not-responsive)').addClass('img-responsive');\n\t\t\t\tpostContainer.find('.preview').html(preview);\n\t\t\t\t$(window).trigger('action:composer.preview');\n\t\t\t\tcallback();\n\t\t\t});\n\t\t}, 250);\n\t};\n\n\tpreview.matchScroll = function(postContainer) {\n\t\tvar textarea = postContainer.find('textarea');\n\t\tvar preview = postContainer.find('.preview');\n\n\t\tif (textarea.length && preview.length) {\n\t\t\tvar diff = textarea[0].scrollHeight - textarea.height();\n\n\t\t\tif (diff === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar scrollPercent = textarea.scrollTop() / diff;\n\n\t\t\tpreview.scrollTop(Math.max(preview[0].scrollHeight - preview.height(), 0) * scrollPercent);\n\t\t}\n\t};\n\n\tpreview.handleToggler = function(postContainer) {\n\t\tfunction hidePreview() {\n\t\t\ttogglePreview(false);\n\t\t\tlocalStorage.setItem('composer:previewToggled', true);\n\t\t}\n\n\t\tfunction showPreview() {\n\t\t\ttogglePreview(true);\n\t\t\tlocalStorage.removeItem('composer:previewToggled');\n\t\t}\n\n\t\tfunction togglePreview(show) {\n\t\t\tpreviewContainer.toggleClass('hide', !show);\n\t\t\twriteContainer.toggleClass('maximized', !show);\n\t\t\tshowBtn.toggleClass('hide', show);\n\n\t\t\t$('.write').focus();\n\t\t\tpreview.matchScroll(postContainer);\n\t\t}\n\n\t\tvar showBtn = postContainer.find('.write-container .toggle-preview'),\n\t\t\thideBtn = postContainer.find('.preview-container .toggle-preview'),\n\t\t\tpreviewContainer = $('.preview-container'),\n\t\t\twriteContainer = $('.write-container');\n\n\t\thideBtn.on('click', hidePreview);\n\t\tshowBtn.on('click', showPreview);\n\n\t\tif (localStorage.getItem('composer:previewToggled')) {\n\t\t\thidePreview();\n\t\t} else {\n\t\t\tshowPreview();\n\t\t}\n\t};\n\n\treturn preview;\n});"]}