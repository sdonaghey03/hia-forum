{"version":3,"sources":["public/src/client/footer.js"],"names":["define","Notifications","Chat","components","translator","prepareDOM","updateUnreadTopicCount","url","count","utils","isNumber","$","config","relative_path","toggleClass","attr","updateUnreadChatCount","get","initUnreadTopics","unreadTopics","onNewPost","data","posts","length","post","parseInt","uid","app","user","topic","tid","increaseUnreadCount","markTopicsUnread","unreadTopicCount","isNewTopic","isMain","unreadNewTopicCount","socket","emit","err","isFollowed","alertError","message","unreadWatchedTopicCount","addClass","window","on","ev","match","alert","updateUnreadCounters","unreadChatCount","updateNotifCount","unreadNotificationCount"],"mappings":"AAAA,aAGAA,OAAO,gBAAiB,gBAAiB,OAAQ,aAAc,cAAe,SAAUC,EAAeC,EAAMC,EAAYC,GACxHH,EAAcI,aACdH,EAAKG,aACLD,EAAWC,aAEX,SAASC,EAAuBC,EAAKC,GACpC,IAAKC,MAAMC,SAASF,GAAQ,CAC3B,OAEDG,EAAE,WAAaC,OAAOC,cAAgBN,EAAM,wBAC1CO,YAAY,eAAgBN,EAAQ,GACpCO,KAAK,eAAgBP,EAAQ,GAAK,MAAQA,GAG7C,SAASQ,EAAsBR,GAC9BL,EAAWc,IAAI,aACbH,YAAY,eAAgBN,EAAQ,GACpCO,KAAK,eAAgBP,EAAQ,GAAK,MAAQA,GAG7C,SAASU,IACR,IAAIC,KAEJ,SAASC,EAAUC,GAClB,GAAIA,GAAQA,EAAKC,OAASD,EAAKC,MAAMC,OAAQ,CAC5C,IAAIC,EAAOH,EAAKC,MAAM,GAEtB,GAAIG,SAASD,EAAKE,IAAK,MAAQD,SAASE,IAAIC,KAAKF,IAAK,MAAQP,EAAaK,EAAKK,MAAMC,KAAM,CAC3FC,EAAoBV,GACpBW,EAAiBR,EAAKK,MAAMC,KAC5BX,EAAaK,EAAKK,MAAMC,KAAO,OAKlC,SAASC,EAAoBV,GAC5B,IAAIG,EAAOH,EAAKC,MAAM,GAEtB,IAAIW,EAAmBR,SAASd,EAAE,WAAaC,OAAOC,cAAgB,+BAA+BE,KAAK,gBAAiB,IAAM,EACjIT,EAAuB,UAAW2B,GAElC,IAAIC,EAAaV,EAAKW,QAAUV,SAASD,EAAKE,IAAK,MAAQD,SAASE,IAAIC,KAAKF,IAAK,IAClF,GAAIQ,EAAY,CACf,IAAIE,EAAsBX,SAASd,EAAE,WAAaC,OAAOC,cAAgB,mCAAmCE,KAAK,gBAAiB,IAAM,EACxIT,EAAuB,cAAe8B,GAEvCC,OAAOC,KAAK,oBAAqBd,EAAKK,MAAMC,IAAK,SAAUS,EAAKC,GAC/D,GAAID,EAAK,CACR,OAAOZ,IAAIc,WAAWF,EAAIG,SAE3B,GAAIF,EAAY,CACf,IAAIG,EAA0BlB,SAASd,EAAE,WAAaC,OAAOC,cAAgB,uCAAuCE,KAAK,gBAAiB,IAAM,EAChJT,EAAuB,kBAAmBqC,MAK7C,SAASX,EAAiBF,GACzBnB,EAAE,cAAgBmB,EAAM,MAAMc,SAAS,UAGxCjC,EAAEkC,QAAQC,GAAG,qBAAsB,SAAUC,EAAI1B,GAChD,GAAIA,EAAKd,IAAK,CACb,IAAIuB,EAAMT,EAAKd,IAAIyC,MAAM,iBAEzB,GAAIlB,GAAOA,EAAI,GAAI,QACXX,EAAaW,EAAI,QAK3BO,OAAOS,GAAG,iBAAkB1B,GAG7B,GAAIO,IAAIC,KAAKF,IAAK,CACjBW,OAAOC,KAAK,uBAAwB,SAAUC,EAAKlB,GAClD,GAAIkB,EAAK,CACR,OAAOZ,IAAIsB,MAAMV,EAAIG,SAGtBQ,EAAqB7B,GAErBL,EAAsBK,EAAK8B,iBAC3BlD,EAAcmD,iBAAiB/B,EAAKgC,2BAItC,SAASH,EAAqB7B,GAC7Bf,EAAuB,UAAWe,EAAKY,kBACvC3B,EAAuB,cAAee,EAAKe,qBAC3C9B,EAAuB,kBAAmBe,EAAKsB,yBAGhDN,OAAOS,GAAG,2BAA4BI,GACtCb,OAAOS,GAAG,+BAAgC9B,GAE1CE","file":"public/src/client/footer.js","sourcesContent":["'use strict';\n\n\ndefine('forum/footer', ['notifications', 'chat', 'components', 'translator'], function (Notifications, Chat, components, translator) {\n\tNotifications.prepareDOM();\n\tChat.prepareDOM();\n\ttranslator.prepareDOM();\n\n\tfunction updateUnreadTopicCount(url, count) {\n\t\tif (!utils.isNumber(count)) {\n\t\t\treturn;\n\t\t}\n\t\t$('a[href=\"' + config.relative_path + url + '\"].navigation-link i')\n\t\t\t.toggleClass('unread-count', count > 0)\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\n\t}\n\n\tfunction updateUnreadChatCount(count) {\n\t\tcomponents.get('chat/icon')\n\t\t\t.toggleClass('unread-count', count > 0)\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\n\t}\n\n\tfunction initUnreadTopics() {\n\t\tvar unreadTopics = {};\n\n\t\tfunction onNewPost(data) {\n\t\t\tif (data && data.posts && data.posts.length) {\n\t\t\t\tvar post = data.posts[0];\n\n\t\t\t\tif (parseInt(post.uid, 10) !== parseInt(app.user.uid, 10) && !unreadTopics[post.topic.tid]) {\n\t\t\t\t\tincreaseUnreadCount(data);\n\t\t\t\t\tmarkTopicsUnread(post.topic.tid);\n\t\t\t\t\tunreadTopics[post.topic.tid] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction increaseUnreadCount(data) {\n\t\t\tvar post = data.posts[0];\n\n\t\t\tvar unreadTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread\"].navigation-link i').attr('data-content'), 10) + 1;\n\t\t\tupdateUnreadTopicCount('/unread', unreadTopicCount);\n\n\t\t\tvar isNewTopic = post.isMain && parseInt(post.uid, 10) !== parseInt(app.user.uid, 10);\n\t\t\tif (isNewTopic) {\n\t\t\t\tvar unreadNewTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread/new\"].navigation-link i').attr('data-content'), 10) + 1;\n\t\t\t\tupdateUnreadTopicCount('/unread/new', unreadNewTopicCount);\n\t\t\t}\n\t\t\tsocket.emit('topics.isFollowed', post.topic.tid, function (err, isFollowed) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tif (isFollowed) {\n\t\t\t\t\tvar unreadWatchedTopicCount = parseInt($('a[href=\"' + config.relative_path + '/unread/watched\"].navigation-link i').attr('data-content'), 10) + 1;\n\t\t\t\t\tupdateUnreadTopicCount('/unread/watched', unreadWatchedTopicCount);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction markTopicsUnread(tid) {\n\t\t\t$('[data-tid=\"' + tid + '\"]').addClass('unread');\n\t\t}\n\n\t\t$(window).on('action:ajaxify.end', function (ev, data) {\n\t\t\tif (data.url) {\n\t\t\t\tvar tid = data.url.match(/^topic\\/(\\d+)/);\n\n\t\t\t\tif (tid && tid[1]) {\n\t\t\t\t\tdelete unreadTopics[tid[1]];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsocket.on('event:new_post', onNewPost);\n\t}\n\n\tif (app.user.uid) {\n\t\tsocket.emit('user.getUnreadCounts', function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alert(err.message);\n\t\t\t}\n\n\t\t\tupdateUnreadCounters(data);\n\n\t\t\tupdateUnreadChatCount(data.unreadChatCount);\n\t\t\tNotifications.updateNotifCount(data.unreadNotificationCount);\n\t\t});\n\t}\n\n\tfunction updateUnreadCounters(data) {\n\t\tupdateUnreadTopicCount('/unread', data.unreadTopicCount);\n\t\tupdateUnreadTopicCount('/unread/new', data.unreadNewTopicCount);\n\t\tupdateUnreadTopicCount('/unread/watched', data.unreadWatchedTopicCount);\n\t}\n\n\tsocket.on('event:unread.updateCount', updateUnreadCounters);\n\tsocket.on('event:unread.updateChatCount', updateUnreadChatCount);\n\n\tinitUnreadTopics();\n});\n"]}