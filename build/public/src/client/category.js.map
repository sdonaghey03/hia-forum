{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","categoryTools","sort","components","translator","topicSelect","pagination","storage","Benchpress","Category","$","window","on","ev","data","String","url","startsWith","disable","removeListeners","socket","removeListener","onNewTopic","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","handleSort","slug","enableInfiniteLoadingOrPagination","clickedIndex","this","parents","attr","each","index","el","offset","top","scrollTop","setItem","handleScrollToTopicIndex","handleIgnoreWatch","trigger","topics","parts","location","pathname","split","topicIndex","length","utils","isNumber","Math","max","parseInt","search","indexOf","scrollToElement","$this","command","emit","err","alertError","message","toggleClass","alertSuccess","toTop","toBottom","count","scrollBottom","navigatorCallback","topIndex","bottomIndex","template","category","bookmarkIndex","getItem","removeItem","config","usePagination","page","ceil","topicsPerPage","currentPage","loadPage","scrollToTopic","highlightTopic","empty","loadTopicsAfter","one","highlight","get","hasClass","addClass","setTimeout","removeClass","duration","scrollTo","animate","undefined","update","topic_count","loadMoreTopics","topic","editable","parse","privileges","showSelect","html","translate","translatedHTML","container","numTopics","noTopicsWarning","remove","widgets","render","slice","x","pinned","insertBefore","insertAfter","append","hide","fadeIn","find","timeago","createUserTooltips","updateTopicCount","topicCount","setCount","direction","children","afterEl","last","first","after","callback","params","loadMore","query","categoryTopicSort","done","onTopicsLoaded","removeAlreadyAddedTopics","filter","tid","before","parseAndTranslate","height","document","getSelectedTids","removeExtra","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/client/category.js","sourcesContent":["'use strict';\n\n\ndefine('forum/category', [\n\t'forum/infinitescroll',\n\t'share',\n\t'navigator',\n\t'forum/category/tools',\n\t'sort',\n\t'components',\n\t'translator',\n\t'topicSelect',\n\t'forum/pagination',\n\t'storage',\n\t'benchpress',\n], function (infinitescroll, share, navigator, categoryTools, sort, components, translator, topicSelect, pagination, storage, Benchpress) {\n\tvar Category = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (!String(data.url).startsWith('category/')) {\n\t\t\tnavigator.disable();\n\n\t\t\tremoveListeners();\n\t\t}\n\t});\n\n\tfunction removeListeners() {\n\t\tsocket.removeListener('event:new_topic', Category.onNewTopic);\n\t\tcategoryTools.removeListeners();\n\t}\n\n\tCategory.init = function () {\n\t\tvar\tcid = ajaxify.data.cid;\n\n\t\tapp.enterRoom('category_' + cid);\n\n\t\tshare.addShareHandlers(ajaxify.data.name);\n\n\t\tsocket.removeListener('event:new_topic', Category.onNewTopic);\n\t\tsocket.on('event:new_topic', Category.onNewTopic);\n\n\t\tcategoryTools.init(cid);\n\n\t\tsort.handleSort('categoryTopicSort', 'user.setCategorySort', 'category/' + ajaxify.data.slug);\n\n\t\tenableInfiniteLoadingOrPagination();\n\n\t\t$('[component=\"category\"]').on('click', '[component=\"topic/header\"]', function () {\n\t\t\tvar clickedIndex = $(this).parents('[data-index]').attr('data-index');\n\t\t\t$('[component=\"category/topic\"]').each(function (index, el) {\n\t\t\t\tif ($(el).offset().top - $(window).scrollTop() > 0) {\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark', $(el).attr('data-index'));\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark:clicked', clickedIndex);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\thandleScrollToTopicIndex();\n\n\t\thandleIgnoreWatch(cid);\n\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\n\t};\n\n\tfunction handleScrollToTopicIndex() {\n\t\tvar parts = window.location.pathname.split('/');\n\t\tvar topicIndex = parts[parts.length - 1];\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10) - 1);\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleIgnoreWatch(cid) {\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"]').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar command = $this.attr('component') === 'category/watching' ? 'watch' : 'ignore';\n\n\t\t\tsocket.emit('categories.' + command, cid, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', command !== 'watch');\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', command === 'watch');\n\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', command !== 'ignore');\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', command === 'ignore');\n\n\t\t\t\tapp.alertSuccess('[[category:' + command + '.message]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tCategory.toTop = function () {\n\t\tnavigator.scrollTop(0);\n\t};\n\n\tCategory.toBottom = function () {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tnavigator.scrollBottom(count - 1);\n\t\t});\n\t};\n\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\n\t\treturn bottomIndex;\n\t};\n\n\t$(window).on('action:popstate', function () {\n\t\tif (ajaxify.data.template.category && ajaxify.data.cid) {\n\t\t\tvar bookmarkIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tvar clickedIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tbookmarkIndex = Math.max(0, parseInt(bookmarkIndex, 10) || 0);\n\t\t\tclickedIndex = Math.max(0, parseInt(clickedIndex, 10) || 0);\n\t\t\tif (!parseInt(bookmarkIndex, 10)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (config.usePagination) {\n\t\t\t\tvar page = Math.ceil((parseInt(bookmarkIndex, 10) + 1) / config.topicsPerPage);\n\t\t\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\t\t\tpagination.loadPage(page, function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bookmarkIndex === 0) {\n\t\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category\"]').empty();\n\n\t\t\t\tloadTopicsAfter(Math.max(0, bookmarkIndex - 1) + 1, 1, function () {\n\t\t\t\t\t$(window).one('action:topics.loaded', function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tCategory.highlightTopic = function (topicIndex) {\n\t\tvar highlight = components.get('category/topic', 'index', topicIndex);\n\n\t\tif (highlight.length && !highlight.hasClass('highlight')) {\n\t\t\thighlight.addClass('highlight');\n\t\t\tsetTimeout(function () {\n\t\t\t\thighlight.removeClass('highlight');\n\t\t\t}, 5000);\n\t\t}\n\t};\n\n\tCategory.scrollToTopic = function (bookmarkIndex, clickedIndex, duration, offset) {\n\t\tif (!bookmarkIndex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!offset) {\n\t\t\toffset = 0;\n\t\t}\n\n\t\tvar scrollTo = components.get('category/topic', 'index', bookmarkIndex);\n\n\t\tif (scrollTo.length) {\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: (scrollTo.offset().top - offset) + 'px',\n\t\t\t}, duration !== undefined ? duration : 400, function () {\n\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\tnavigator.update();\n\t\t\t});\n\t\t}\n\t};\n\n\tfunction enableInfiniteLoadingOrPagination() {\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\n\t\t\tinfinitescroll.init($('[component=\"category\"]'), Category.loadMoreTopics);\n\t\t} else {\n\t\t\tnavigator.disable();\n\t\t}\n\t}\n\n\tCategory.onNewTopic = function (topic) {\n\t\tvar\tcid = ajaxify.data.cid;\n\t\tif (!topic || parseInt(topic.cid, 10) !== parseInt(cid, 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$(window).trigger('filter:categories.new_topic', topic);\n\n\t\tvar editable = !!$('.thread-tools').length;\n\n\t\tBenchpress.parse('category', 'topics', {\n\t\t\tprivileges: { editable: editable },\n\t\t\tshowSelect: editable,\n\t\t\ttopics: [topic],\n\t\t\ttemplate: { category: true },\n\t\t}, function (html) {\n\t\t\ttranslator.translate(html, function (translatedHTML) {\n\t\t\t\tvar topic = $(translatedHTML);\n\t\t\t\tvar container = $('[component=\"category\"]');\n\t\t\t\tvar topics = $('[component=\"category/topic\"]');\n\t\t\t\tvar numTopics = topics.length;\n\n\t\t\t\t$('[component=\"category\"]').removeClass('hidden');\n\t\t\t\t$('.category-sidebar').removeClass('hidden');\n\n\t\t\t\tvar noTopicsWarning = $('#category-no-topics');\n\t\t\t\tif (noTopicsWarning.length) {\n\t\t\t\t\tnoTopicsWarning.remove();\n\t\t\t\t\tajaxify.widgets.render('category', window.location.pathname.slice(1));\n\t\t\t\t}\n\n\t\t\t\tif (numTopics > 0) {\n\t\t\t\t\tfor (var x = 0; x < numTopics; x += 1) {\n\t\t\t\t\t\tvar pinned = $(topics[x]).hasClass('pinned');\n\t\t\t\t\t\tif (!pinned) {\n\t\t\t\t\t\t\ttopic.insertBefore(topics[x]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (x === numTopics - 1) {\n\t\t\t\t\t\t\ttopic.insertAfter(topics[x]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.append(topic);\n\t\t\t\t}\n\n\t\t\t\ttopic.hide().fadeIn('slow');\n\n\t\t\t\ttopic.find('.timeago').timeago();\n\t\t\t\tapp.createUserTooltips();\n\t\t\t\tupdateTopicCount();\n\n\t\t\t\t$(window).trigger('action:categories.new_topic.loaded');\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction updateTopicCount() {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, topicCount) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tnavigator.setCount(topicCount);\n\t\t});\n\t}\n\n\tCategory.loadMoreTopics = function (direction) {\n\t\tif (!$('[component=\"category\"]').length || !$('[component=\"category\"]').children().length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar topics = $('[component=\"category/topic\"]');\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + (direction > 0 ? 1 : 0);\n\n\t\tloadTopicsAfter(after, direction);\n\t};\n\n\tfunction loadTopicsAfter(after, direction, callback) {\n\t\tcallback = callback || function () {};\n\t\tif (!utils.isNumber(after) || (after === 0 && components.get('category/topic', 'index', 0).length)) {\n\t\t\treturn callback();\n\t\t}\n\n\t\t$(window).trigger('action:category.loading');\n\t\tvar params = utils.params();\n\t\tinfinitescroll.loadMore('categories.loadMore', {\n\t\t\tcid: ajaxify.data.cid,\n\t\t\tafter: after,\n\t\t\tdirection: direction,\n\t\t\tquery: params,\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\n\t\t}, function (data, done) {\n\t\t\tif (data.topics && data.topics.length) {\n\t\t\t\tCategory.onTopicsLoaded(data, direction, done);\n\t\t\t} else {\n\t\t\t\tdone();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:category.loaded');\n\t\t\tcallback();\n\t\t});\n\t}\n\n\n\tCategory.onTopicsLoaded = function (data, direction, callback) {\n\t\tif (!data || !data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tfunction removeAlreadyAddedTopics(topics) {\n\t\t\treturn topics.filter(function (topic) {\n\t\t\t\treturn components.get('category/topic', 'tid', topic.tid).length === 0;\n\t\t\t});\n\t\t}\n\n\t\tdata.topics = removeAlreadyAddedTopics(data.topics);\n\t\tif (!data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tdata.showSelect = data.privileges.editable;\n\n\t\tvar after;\n\t\tvar before;\n\t\tvar topics = $('[component=\"category/topic\"]');\n\n\t\tif (direction > 0 && topics.length) {\n\t\t\tafter = topics.last();\n\t\t} else if (direction < 0 && topics.length) {\n\t\t\tbefore = topics.first();\n\t\t}\n\n\t\tapp.parseAndTranslate('category', 'topics', data, function (html) {\n\t\t\t$('[component=\"category\"]').removeClass('hidden');\n\t\t\t$('.category-sidebar').removeClass('hidden');\n\n\t\t\t$('#category-no-topics').remove();\n\n\t\t\tif (after) {\n\t\t\t\thtml.insertAfter(after);\n\t\t\t} else if (before) {\n\t\t\t\tvar height = $(document).height();\n\t\t\t\tvar scrollTop = $(window).scrollTop();\n\n\t\t\t\thtml.insertBefore(before);\n\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\n\t\t\t} else {\n\t\t\t\t$('[component=\"category\"]').append(html);\n\t\t\t}\n\n\t\t\tif (!topicSelect.getSelectedTids().length) {\n\t\t\t\tinfinitescroll.removeExtra($('[component=\"category/topic\"]'), direction, config.topicsPerPage * 3);\n\t\t\t}\n\n\t\t\thtml.find('.timeago').timeago();\n\t\t\tapp.createUserTooltips();\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\n\t\t\t$(window).trigger('action:topics.loaded', { topics: data.topics });\n\n\t\t\tcallback();\n\t\t});\n\t};\n\n\treturn Category;\n});\n"]}