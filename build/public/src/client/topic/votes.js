"use strict";define("forum/topic/votes",["components","translator","benchpress"],function(t,o,e){var n={};n.addVoteHandler=function(){t.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',a);t.get("topic").on("mouseout",'[data-pid] [component="post/vote-count"]',function(){var t=$(this).parent();t.on("shown.bs.tooltip",function(){$(".tooltip").tooltip("destroy");t.off("shown.bs.tooltip")});$(".tooltip").tooltip("destroy")})};function a(t){t.stopPropagation();var o=$(this);var e=o.parent();var n=e.parents("[data-pid]").attr("data-pid");$(".tooltip").tooltip("destroy");o.off("mouseenter",a);socket.emit("posts.getUpvoters",[n],function(t,n){if(t){return app.alertError(t.message)}if(n.length){r(e,n[0])}o.off("mouseenter").on("mouseenter",a)});return false}function r(t,e){function n(o){t.attr("title",o).tooltip("fixTitle").tooltip("show")}var a=e.usernames;if(!a.length){return}if(a.length+e.otherCount>6){a=a.join(", ").replace(/,/g,"|");o.translate("[[topic:users_and_others, "+a+", "+e.otherCount+"]]",function(t){t=t.replace(/\|/g,",");n(t)})}else{a=a.join(", ");n(a)}}n.toggleVote=function(t,o,e){var a=t.parents("[data-pid]");var r=a.find(o).length;socket.emit(r?"posts.unvote":e,{pid:a.attr("data-pid"),room_id:"topic_"+ajaxify.data.tid},function(t){if(t){if(t.message==="self-vote"){n.showVotes(a.attr("data-pid"))}else{app.alertError(t.message)}}});return false};n.showVotes=function(t){socket.emit("posts.getVoters",{pid:t,cid:ajaxify.data.cid},function(t,n){if(t){if(t.message==="[[error:no-privileges]]"){return}return app.alertError(t.message)}e.parse("partials/modals/votes_modal",n,function(t){o.translate(t,function(t){var o=bootbox.dialog({title:"Voters",message:t,className:"vote-modal",show:true});o.on("click",function(){o.modal("hide")})})})})};return n});
//# sourceMappingURL=public/src/client/topic/votes.js.map