"use strict";define("uploader",["translator","benchpress"],function(e,r){var o={};o.open=function(e,r,s,t){console.warn("[uploader] uploader.open() is deprecated, please use uploader.show() instead, and pass parameters as a singe option with callback, e.g. uploader.show({}, callback);");o.show({route:e,params:r,fileSize:s},t)};o.show=function(e,r){var o=e.hasOwnProperty("fileSize")&&e.fileSize!==undefined?parseInt(e.fileSize,10):false;t({showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==undefined?e.showHelp:true,fileSize:o,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(t){t=$(t);t.modal("show");t.on("hidden.bs.modal",function(){t.remove()});var a=t.find("#uploadForm");a.attr("action",e.route);a.find("#params").val(JSON.stringify(e.params));t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled");a.submit()});a.submit(function(){s(t,o,r);return false})})};o.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function s(e,r,s){function t(r,s){o.hideAlerts(e);if(r==="error"){e.find("#fileUploadSubmitBtn").removeClass("disabled")}e.find("#alert-"+r).translateText(s).removeClass("hide")}t("status","[[uploads:uploading-file]]");e.find("#upload-progress-bar").css("width","0%");e.find("#upload-progress-box").show().removeClass("hide");var n=e.find("#fileInput");if(!n.val()){return t("error","[[uploads:select-file-to-upload]]")}if(!i(n[0],r)){return t("error","[[error:file-too-big, "+r+"]]")}e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=a(e);t("error",e.responseJSON?e.responseJSON.error||e.statusText:"error uploading, code : "+e.status)},uploadProgress:function(r,o,s,t){e.find("#upload-progress-bar").css("width",t+"%")},success:function(r){r=a(r);if(r.error){return t("error",r.error)}s(r[0].url);t("success","[[uploads:upload-success]]");setTimeout(function(){o.hideAlerts(e);e.modal("hide")},750)}})}function t(o,s){r.parse("partials/modals/upload_file_modal",o,function(r){e.translate(r,s)})}function a(e){if(typeof e==="string"){try{return $.parseJSON(e)}catch(e){return{error:"[[error:parse-error]]"}}}return e}function i(e,r){if(window.FileReader&&r){return e.files[0].size<=r*1e3}return true}return o});
//# sourceMappingURL=public/src/modules/uploader.js.map